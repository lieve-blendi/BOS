do local a={"/boot/kernel/pipes","/OS.lua","/init.lua"}local b=component;local c=computer;local d=b.invoke;local function e(f,g,...)local h=table.pack(pcall(d,f,g,...))if not h[1]then return nil,h[2]else return table.unpack(h,2,h.n)end end;local function i(j)local k=b.proxy(j)for l,m in ipairs(a)do if k.exists(m)then return m end end end;local function n(o)local p=b.list("internet")()if not p then return end;local q=b.proxy(p)local r,s=q.request(o)local h=""while true do s=r.read(math.huge)if s then h=h..s else break end end;r.close()return h end;local function t(u)local v=b.proxy(u)local w=v.list("/")for x,m in ipairs(w)do v.remove(m)end;v.setLabel(nil)end;local y=b.list("eeprom")()c.getBootAddress=function()return e(y,"getData")end;c.setBootAddress=function(f)return e(y,"setData",f)end;local z=b.list("screen")()local A=b.proxy(b.list("gpu")())if A and z then e(A,"bind",z)end;if not A then error("No graphics card available")end;local B,C=A.getResolution()A.setForeground(0xFFFFFF)A.setBackground(0)A.fill(1,1,B,C," ")A.set(1,1,"Wings BIOS")A.set(1,2,"Press left control to boot BIOS")local function D(u)c.setBootAddress(u)A.fill(1,1,B,C," ")A.set(1,1,"Booting in "..u.."...")local E=i(u)local r,F=e(u,"open",E)if not r then return nil,F end;local G=""repeat local H,F=e(u,"read",r,math.huge)if not H and F then return nil,F end;G=G..(H or"")until not H;e(u,"close",r)return load(G,"="..E)end;local function I()local J=D(c.getBootAddress())if J then J()else for K in b.list("filesystem")do J=D(K)if J then return J()end end;if J then J()else error("No bootable device found")end end end;do local L,M,M,N=c.pullSignal(3)if L~="key_down"or N~=29 then local J=D(c.getBootAddress())if J then J()else for K in b.list("filesystem")do J=D(K)if J then return J()end end;if J then J()else error("No bootable device found")end end end end;local O="m"local P=""local Q=""local R=""local S=""while true do A.fill(1,1,B,C," ")local T={}local U={}for K in b.list("filesystem")do local V=b.proxy(K)if c.tmpAddress()~=K then table.insert(T,K)local W=""if c.getBootAddress()==K then W=" < Default boot drive"end;local X=V.getLabel()local Y=math.floor(V.spaceUsed()/1048576*100)/100;local Z=math.floor(V.spaceTotal()/1048576*100)/100;if X then table.insert(U,X.." ("..string.sub(K,1,8)..") ("..Y.."/"..Z.."MB used)"..W)else table.insert(U,string.sub(K,1,8).." ("..Y.."/"..Z.."MB used)"..W)end end end;if O=="m"then local _={"d","Update BIOS"}for l,m in ipairs(_)do A.set(1,l,m)end;local L,M,a0,a1=c.pullSignal()if L=="touch"then for l,m in ipairs(_)do if a1==l then if a0>=1 and a0<=#m then if l==1 then O="d"elseif l==2 then local a2=n("https://raw.githubusercontent.com/lieve-blendi/BOS/main/firmware/Wings/minified.lua")if a2 then else R="No internet card detected"S="m"O="e"end end end end end end end;if O=="d"then local _={table.unpack(U),"Boot normally","Back"}for l,m in ipairs(_)do A.set(1,l,m)end;local L,M,a0,a1=c.pullSignal()if L=="touch"then for l,m in ipairs(_)do if a1==l then if a0>=1 and a0<=#m then if l<=#U then P=T[l]Q=U[l]O="ds"elseif l==#U+1 then I()elseif l==#U+2 then O="m"end end end end end end;if O=="ds"then local _={Q,"","Erase Drive","Boot Drive","Back"}for l,m in ipairs(_)do A.set(1,l,m)end;local L,M,a0,a1=c.pullSignal()if L=="touch"then for l,m in ipairs(_)do if a1==l then if a0>=1 and a0<=#m then if l==3 then O="es"elseif l==4 then local J=D(P)if J then J()else R="Drive failed to boot"S="ds"O="e"end elseif l==5 then O="d"P=""end end end end end end;if O=="es"then local _={"Are you sure you want to erase this drive?","","Yes","No"}for l,m in ipairs(_)do A.set(1,l,m)end;local L,M,a0,a1=c.pullSignal()if L=="touch"then for l,m in ipairs(_)do if a1==l then if a0>=1 and a0<=#m then if l==3 then t(P)O="d"P=""elseif l==4 then O="d"P=""end end end end end end;if O=="e"then local _={R,"","Back"}for l,m in ipairs(_)do A.set(1,l,m)end;local L,M,a0,a1=c.pullSignal()if L=="touch"then for l,m in ipairs(_)do if a1==l then if a0>=1 and a0<=#m then if l==3 then O=S end end end end end end end end
