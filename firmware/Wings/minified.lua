do local a={"/boot/kernel/pipes","/OS.lua","/init.lua"}local b=component;local c=computer;local d=b.invoke;local function e(f,g,...)local h=table.pack(pcall(d,f,g,...))if not h[1]then return nil,h[2]else return table.unpack(h,2,h.n)end end;local function i(j)local k=b.proxy(j)for l,m in ipairs(a)do if k.exists(m)then return m end end end;local function n(o)local p=b.list("internet")()if not p then return end;local q=b.proxy(p)local r,s=q.request(o)local h=""while true do s=r.read(math.huge)if s then h=h..s else break end end;r.close()return h end;local function t(u)local v=b.proxy(u)local w=v.list("/")for x,m in ipairs(w)do v.remove(m)end;v.setLabel(nil)end;local y=b.list("eeprom")()c.getBootAddress=function()return e(y,"getData")end;c.setBootAddress=function(f)return e(y,"setData",f)end;local z=b.list("screen")()local A=b.proxy(b.list("gpu")())if A and z then e(A,"bind",z)end;if not A then error("No graphics card available")end;local B,C=A.getResolution()A.setForeground(0xFFFFFF)A.setBackground(0)A.fill(1,1,B,C," ")A.set(1,1,"Wings BIOS")A.set(1,2,"Press left control to boot BIOS")local function D(u)c.setBootAddress(u)A.fill(1,1,B,C," ")A.set(1,1,"Booting in "..u.."...")local E=i(u)local r,F=e(u,"open",E)if not r then return nil,F end;local G=""repeat local H,F=e(u,"read",r,math.huge)if not H and F then return nil,F end;G=G..(H or"")until not H;e(u,"close",r)return load(G,"="..E)end;do local I,J,J,K=c.pullSignal(3)if I~="key_down"or K~=29 then local L,F=D(c.getBootAddress())if L then L()else for M in b.list("filesystem")do L,F=D(M)if L then return L()end end;if L then L()else error("No bootable device found")end end end end;local N="main"local O=""local P=""while true do A.fill(1,1,B,C," ")local Q={}local R={}for M in b.list("filesystem")do local S=b.proxy(M)if c.tmpAddress()~=M then table.insert(Q,M)local T=""if c.getBootAddress()==M then T=" < Default boot drive"end;local U=S.getLabel()local V=math.floor(S.spaceUsed()/1048576*100)/100;local W=math.floor(S.spaceTotal()/1048576*100)/100;if U then table.insert(R,U.." ("..string.sub(M,1,8)..") ("..V.."/"..W.."MB used)"..T)else table.insert(R,string.sub(M,1,8).." ("..V.."/"..W.."MB used)"..T)end end end;if N=="main"then local X={"Drives","Update BIOS"}for l,m in ipairs(X)do A.set(1,l,m)end;local I,J,Y,Z=c.pullSignal()if I=="touch"then for l,m in ipairs(X)do if Z==l then if Y>=1 and Y<=#m then if l==1 then N="drives"elseif l==2 then local _=n("https://raw.githubusercontent.com/lieve-blendi/BOS/main/firmware/Wings/minified.lua")if _ then else N="nointcard"end end end end end end end;if N=="drives"then local a0="Boot normally"local a1="Back"for l,m in ipairs(Q)do A.set(1,l,R[l])end;A.set(1,#Q+1,a0)A.set(1,#Q+2,a1)local I,J,Y,Z=c.pullSignal()if I=="touch"then if Z>=1 and Z<=#Q then if Y>=1 and Y<=#R[Z]then O=Q[Z]P=R[Z]N="drivesettings"end elseif Z==#Q+1 then if Y>=1 and Y<=#a0 then local L,F=D(c.getBootAddress())if L then L()else for M in b.list("filesystem")do L,F=D(M)if L then return L()end end;if L then L()else error("No bootable device found")end end end elseif Z==#Q+2 then if Y>=1 and Y<=#a1 then N="main"end end end end;if N=="drivesettings"then local X={P,"","Erase Drive","Boot Drive","Back"}for l,m in ipairs(X)do A.set(1,l,m)end;local I,J,Y,Z=c.pullSignal()if I=="touch"then for l,m in ipairs(X)do if Z==l then if Y>=1 and Y<=#m then if l==3 then N="erasesure"elseif l==4 then local L,F=D(O)if L then L()else N="bootfail"end elseif l==5 then N="drives"O=""end end end end end end;if N=="erasesure"then local X={"Are you sure you want to erase this drive?","","Yes","No"}for l,m in ipairs(X)do A.set(1,l,m)end;local I,J,Y,Z=c.pullSignal()if I=="touch"then for l,m in ipairs(X)do if Z==l then if Y>=1 and Y<=#m then if l==3 then t(O)N="drives"O=""elseif l==4 then N="drives"O=""end end end end end end;if N=="bootfail"then local X={"Drive failed to boot","","Back"}for l,m in ipairs(X)do A.set(1,l,m)end;local I,J,Y,Z=c.pullSignal()if I=="touch"then for l,m in ipairs(X)do if Z==l then if Y>=1 and Y<=#m then if l==3 then N="drivesettings"end end end end end end;if N=="nointcard"then local X={"No internet card detected","","Back"}for l,m in ipairs(X)do A.set(1,l,m)end;local I,J,Y,Z=c.pullSignal()if I=="touch"then for l,m in ipairs(X)do if Z==l then if Y>=1 and Y<=#m then if l==3 then N="main"end end end end end end end end
